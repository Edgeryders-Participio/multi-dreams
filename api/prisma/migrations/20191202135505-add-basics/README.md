# Migration `20191202135505-add-basics`

This migration has been generated by Gustav Larsson at 12/2/2019, 1:55:05 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "public"."User" (
  "avatar" text   ,
  "email" text NOT NULL DEFAULT '' ,
  "id" text NOT NULL  ,
  "name" text   ,
  PRIMARY KEY ("id")
);

CREATE TABLE "public"."Membership" (
  "createdAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  "id" text NOT NULL  ,
  "isActive" boolean NOT NULL DEFAULT false ,
  "isAdmin" boolean NOT NULL DEFAULT false ,
  "isApproved" boolean NOT NULL DEFAULT false ,
  "updatedAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  PRIMARY KEY ("id")
);

CREATE TABLE "public"."Event" (
  "createdAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  "description" text   ,
  "id" text NOT NULL  ,
  "logo" text   ,
  "slug" text NOT NULL DEFAULT '' ,
  "title" text NOT NULL DEFAULT '' ,
  "updatedAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  PRIMARY KEY ("id")
);

CREATE TABLE "public"."Dream" (
  "budgetDescription" text   ,
  "createdAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  "description" text NOT NULL DEFAULT '' ,
  "id" text NOT NULL  ,
  "maxFunding" integer   ,
  "minFunding" integer   ,
  "slug" text NOT NULL DEFAULT '' ,
  "title" text NOT NULL DEFAULT '' ,
  "updatedAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  PRIMARY KEY ("id")
);

CREATE TABLE "public"."Dream_images" (
  "nodeId" text NOT NULL  REFERENCES "public"."Dream"("id") ON DELETE CASCADE,
  "position" integer NOT NULL  ,
  "value" text NOT NULL  ,
  PRIMARY KEY ("nodeId","position")
);

ALTER TABLE "public"."Membership" ADD COLUMN "dream" text   REFERENCES "public"."Dream"("id") ON DELETE SET NULL,
ADD COLUMN "event" text NOT NULL  REFERENCES "public"."Event"("id") ON DELETE RESTRICT,
ADD COLUMN "user" text NOT NULL  REFERENCES "public"."User"("id") ON DELETE RESTRICT;

ALTER TABLE "public"."Dream" ADD COLUMN "event" text NOT NULL  REFERENCES "public"."Event"("id") ON DELETE RESTRICT;

CREATE UNIQUE INDEX "User.email" ON "public"."User"("email")

CREATE UNIQUE INDEX "Event.slug" ON "public"."Event"("slug")

CREATE UNIQUE INDEX "Dream.slug" ON "public"."Dream"("slug")
```

## Changes

```diff
diff --git datamodel.mdl datamodel.mdl
migration ..20191202135505-add-basics
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,54 @@
+generator photon {
+  provider = "photonjs"
+}
+
+datasource db {
+  provider = "postgresql"
+  url      = env("POSTGRES_URL")
+}
+
+model User {
+  id          String       @default(cuid()) @id
+  email       String       @unique
+  memberships Membership[]
+  name        String?
+  avatar      String?
+}
+
+model Membership {
+  id         String   @default(cuid()) @id
+  user       User
+  event      Event
+  isActive   Boolean  @default(false)
+  isApproved Boolean  @default(false)
+  isAdmin    Boolean  @default(false)
+  createdAt  DateTime @default(now())
+  updatedAt  DateTime @updatedAt
+}
+
+model Event {
+  id          String       @default(cuid()) @id
+  slug        String       @unique
+  title       String
+  description String?
+  logo        String?
+  members     Membership[]
+  dreams      Dream[]
+  createdAt   DateTime     @default(now())
+  updatedAt   DateTime     @updatedAt
+}
+
+model Dream {
+  id                String       @default(cuid()) @id
+  slug              String       @unique
+  title             String
+  description       String
+  event             Event
+  images            String[]
+  team              Membership[]
+  minFunding        Int?
+  maxFunding        Int?
+  budgetDescription String?
+  createdAt         DateTime     @default(now())
+  updatedAt         DateTime     @updatedAt
+}
```

## Photon Usage

You can use a specific Photon built for this migration (20191202135505-add-basics)
in your `before` or `after` migration script like this:

```ts
import Photon from '@generated/photon/20191202135505-add-basics'

const photon = new Photon()

async function main() {
  const result = await photon.users()
  console.dir(result, { depth: null })
}

main()

```
